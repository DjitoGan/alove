// ---------- Generators & datasource ----------
generator client {
  provider = "prisma-client-js"
  engineType = "library" 
  seed       = "ts-node ./prisma/seed.ts"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ---------- MODELS MINIMAUX QUI COMPILE ----------

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  password  String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  orders    Order[]
  vendors   Vendor[] // si un user peut aussi être vendeur (optionnel)
}

model Vendor {
  id        String   @id @default(cuid())
  name      String
  userId    String?            // si un vendeur est rattaché à un user (facultatif)
  user      User?   @relation(fields: [userId], references: [id])

  parts       Part[]
  orderItems  OrderItem[]
  shipments   Shipment[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Part {
  id        String   @id @default(cuid())
  title     String
  price     Decimal  @db.Decimal(10,2)
  stock     Int      @default(0)

  vendorId  String
  vendor    Vendor   @relation(fields: [vendorId], references: [id])

  orderItems OrderItem[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([vendorId])
}

model Order {
  id        String   @id @default(cuid())
  status    String   @default("PENDING")
  total     Decimal  @db.Decimal(10,2) @default(0)

  userId    String
  user      User     @relation(fields: [userId], references: [id])

  items     OrderItem[]
  shipments Shipment[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([userId])
}

model OrderItem {
  id        String   @id @default(cuid())
  quantity  Int      @default(1)
  unitPrice Decimal  @db.Decimal(10,2)

  // FK -> Order
  orderId String
  order   Order   @relation(fields: [orderId], references: [id])

  // FK -> Part
  partId String
  part   Part    @relation(fields: [partId], references: [id])

  // FK -> Vendor (le vendeur de la pièce)
  vendorId String
  vendor   Vendor  @relation(fields: [vendorId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([orderId])
  @@index([partId])
  @@index([vendorId])
}

model Shipment {
  id        String   @id @default(cuid())
  status    String   @default("CREATED")

  // FK -> Order
  orderId String
  order   Order   @relation(fields: [orderId], references: [id])

  // FK -> Vendor (expéditeur)
  vendorId String
  vendor   Vendor  @relation(fields: [vendorId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([orderId])
  @@index([vendorId])
}